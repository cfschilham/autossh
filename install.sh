sudo echo "dHJ5OgogICAgaW1wb3J0IG9zLCBzdWJwcm9jZXNzLCBzaHV0aWwsIHN0YXQsIGpzb24sIHN5cywgcGxhdGZvcm0KICAgIGltcG9ydCB0YXJmaWxlCgogICAgUFlUSE9OMiA9IDIKICAgIFBZVEhPTjMgPSAzCgogICAgVkVSU0lPTiA9IDAKCiAgICBMSU5VWCA9IDEKICAgIERBUldJTiA9IDIKICAgIFdJTkRPV1MgPSAzCgogICAgT1MgPSAwCgoKICAgIGlmIHN5cy52ZXJzaW9uX2luZm9bMF0gPCAzOgogICAgICAgIGltcG9ydCB1cmxsaWIyIGFzIHVybGxpYgogICAgICAgIFZFUlNJT04gPSBQWVRIT04yCiAgICBlbHNlOgogICAgICAgIFZFUlNJT04gPSBQWVRIT04zCiAgICAgICAgaW1wb3J0IHVybGxpYi5yZXF1ZXN0IGFzIHVybGxpYgoKICAgIGlmIHBsYXRmb3JtLnN5c3RlbSgpLmxvd2VyKCkgPT0gImxpbnV4IjoKICAgICAgICBPUyA9IExJTlVYCiAgICBlbGlmIHBsYXRmb3JtLnN5c3RlbSgpLmxvd2VyKCkgPT0gImRhcndpbiI6CiAgICAgICAgT1MgPSBEQVJXSU4KICAgIGVsaWYgcGxhdGZvcm0uc3lzdGVtKCkubG93ZXIoKSA9PSAid2luZG93cyI6CiAgICAgICAgT1MgPSBXSU5ET1dTCiAgICBlbHNlOgogICAgICAgIHByaW50KCJVbnN1cHBvcnRlZCBvcyAiICsgcGxhdGZvcm0uc3lzdGVtKCkubG93ZXIoKSkKCiAgICBwcmludCgiR2V0dGluZyBsYXRlc3QgdmVyc2lvbiBmcm9tIGh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vcmVwb3MvY2ZzY2hpbGhhbS9rcnllci9yZWxlYXNlcy9sYXRlc3QiKQogICAgcmVxID0gdXJsbGliLlJlcXVlc3QoImh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vcmVwb3MvY2ZzY2hpbGhhbS9rcnllci9yZWxlYXNlcy9sYXRlc3QiKQogICAgZiA9IHVybGxpYi51cmxvcGVuKHJlcSkKICAgIHJlbGVhc2UgPSBqc29uLmxvYWRzKGYucmVhZCgpKQogICAgcHJpbnQoIlN0YXJ0aW5nIHN5c3RlbSBzY2FuIikKICAgIGlmIG9zLnBhdGguaXNmaWxlKCcvYmluL2tyeWVyJyk6CiAgICAgICAgaWYoVkVSU0lPTiA9PSBQWVRIT04yKToKICAgICAgICAgICAgcSA9IHJhd19pbnB1dCgia3J5ZXIgYWxyZWFkeSBpbnN0YWxsZWQgZG8gd2FudCB0byByZWluc3RhbGwgW1kvbl0/ICIpCiAgICAgICAgaWYoVkVSU0lPTiA9PSBQWVRIT04zKToKICAgICAgICAgICAgcSA9IHN0cihpbnB1dCgia3J5ZXIgYWxyZWFkeSBpbnN0YWxsZWQgZG8gd2FudCB0byByZWluc3RhbGwgW1kvbl0/ICIpKQoKICAgICAgICBpZihxID09ICJuIik6CiAgICAgICAgICAgIGV4aXQoKQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIG9zLnJlbW92ZSgiL3Vzci9iaW4va3J5ZXIiKQogICAgICAgIGV4Y2VwdCBPU0Vycm9yOgogICAgICAgICAgICBwcmludCgiTm90IGVub3VnaCBwZXJtaXNzaW9uIHRvIHJlbW92ZSAvYmluL2tyeWVyIHBsZWFzZSBleGNlY3V0ZSB3aXRoIHN1ZG8hISIpCiAgICAgICAgICAgIGV4aXQoKQogICAgICAgIHByaW50KCJPbGQgZmlsZSByZW1vdmVkLi4uIikKCiAgICBwcmludCgiR2V0dGluZyBjb3JyZWN0IHZlcnNpb24gZm9yIHlvdXIgb3BlcmF0aW5nIHN5c3RlbSBmcm9tICIgKyByZWxlYXNlWyJhc3NldHNfdXJsIl0gKyAiLi4uIikKICAgIHJlcSA9IHVybGxpYi5SZXF1ZXN0KHJlbGVhc2VbImFzc2V0c191cmwiXSkKICAgIGYyID0gdXJsbGliLnVybG9wZW4ocmVxKQogICAgdmVyc2lvbnMgPSBqc29uLmxvYWRzKGYyLnJlYWQoKSkKCiAgICBmb3IgdmVyc2lvbiBpbiB2ZXJzaW9uczoKICAgICAgICBpZihwbGF0Zm9ybS5zeXN0ZW0oKS5sb3dlcigpIGluIHZlcnNpb25bIm5hbWUiXSBhbmQgJ3Rhci5neicgaW4gdmVyc2lvblsibmFtZSJdKToKICAgICAgICAgICAgcHJpbnQoIkRvd25sb2FkaW5nICIgKyB2ZXJzaW9uWyJicm93c2VyX2Rvd25sb2FkX3VybCJdICsgIi4uLiIpCiAgICAgICAgICAgIGlmKFZFUlNJT04gPT0gUFlUSE9OMik6CiAgICAgICAgICAgICAgICB1ID0gdXJsbGliLnVybG9wZW4odmVyc2lvblsiYnJvd3Nlcl9kb3dubG9hZF91cmwiXSkKICAgICAgICAgICAgICAgIGRhdGF0b3dyaXRlID0gdS5yZWFkKCkKCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oIi90bXAva3J5ZXIudGFyLmd6IiwgJ3diJykgYXMgZjoKICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGRhdGF0b3dyaXRlKQoKICAgICAgICAgICAgaWYoVkVSU0lPTiA9PSBQWVRIT04zKToKICAgICAgICAgICAgICAgIHVybGxpYi51cmxyZXRyaWV2ZSh2ZXJzaW9uWyJicm93c2VyX2Rvd25sb2FkX3VybCJdLCAiL3RtcC9rcnllci50YXIuZ3oiKQogICAgICAgICAgICBicmVhazsKCiAgICBwcmludCgiRXh0cmFjdGluZyAiICsgdmVyc2lvblsibmFtZSJdICsgIi4uLiIpCiAgICBuYW1lID0gdmVyc2lvblsibmFtZSJdLnJlcGxhY2UoIi50YXIuZ3oiLCAiIikKCiAgICBpZihvcy5wYXRoLmlzZGlyKCcvdG1wL2tyeWVyJykgPT0gRmFsc2UpOgogICAgICAgIG9zLm1rZGlyKCcvdG1wL2tyeWVyJykKICAgIHRhciA9IHRhcmZpbGUuVGFyRmlsZS5vcGVuKCIvdG1wL2tyeWVyLnRhci5neiIsICJyOmd6IikKICAgIHRhci5leHRyYWN0YWxsKCIvdG1wL2tyeWVyIikKICAgIHRhci5jbG9zZSgpCgogICAgcHJpbnQoIkNyZWF0aW5nIGZpbGVzLi4uIikKCiAgICBzaHV0aWwubW92ZSgiL3RtcC9rcnllci8iICsgbmFtZSArICIva3J5ZXIiLCAiL3Vzci9iaW4va3J5ZXIiKQogICAgcHJpbnQoIk1ha2luZyBleGVjdXRhYmxlLi4uIikKICAgIHN0ID0gb3Muc3RhdCgnL3Vzci9iaW4va3J5ZXInKQogICAgb3MuY2htb2QoIi91c3IvYmluL2tyeWVyIiwgc3Quc3RfbW9kZSB8IHN0YXQuU19JRVhFQykKICAgIHByaW50KCJDbGVhbmluZyB1cC4uLiIpCiAgICBzaHV0aWwucm10cmVlKCIvdG1wL2tyeWVyIikKICAgIG9zLnJlbW92ZSgiL3RtcC9rcnllci50YXIuZ3oiKQogICAgcHJpbnQoIkRvbmUuLi4iKQpleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6CiAgICBwcmludCgiXG5LZXlCb2FyZEludGVycnVwdCBkZXRlY3RlZCEhIikKICAgIHByaW50KCJDbGVhbmluZyB1cC4uLiIpCiAgICBpZihvcy5wYXRoLmlzZGlyKCcvdG1wL2tyeWVyJykpOgogICAgICAgIHNodXRpbC5ybXRyZWUoIi90bXAva3J5ZXIiKQogICAgaWYob3MucGF0aC5pc2ZpbGUoJy90bXAva3J5ZXIudGFyLmd6JykpOgogICAgICAgIG9zLnJlbW92ZSgiL3RtcC9rcnllci50YXIuZ3oiKQogICAgcHJpbnQoIkV4aXRpbmcuLi4iKQ==" | base64 --decode > "/tmp/install.py" && sudo chmod +x "/tmp/install.py" && sudo python "/tmp/install.py" && sudo rm "/tmp/install.py"