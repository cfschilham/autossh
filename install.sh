sudo echo "dHJ5OgogICAgaW1wb3J0IG9zLCBzdWJwcm9jZXNzLCBzaHV0aWwsIHN0YXQsIGpzb24sIHN5cywgcGxhdGZvcm0KICAgIGZyb20gemlwZmlsZSBpbXBvcnQgWmlwRmlsZQoKICAgIFBZVEhPTjIgPSAyCiAgICBQWVRIT04zID0gMwoKICAgIFZFUlNJT04gPSAwCgogICAgTElOVVggPSAxCiAgICBEQVJXSU4gPSAyCiAgICBXSU5ET1dTID0gMwoKICAgIE9TID0gMAoKCiAgICBpZiBzeXMudmVyc2lvbl9pbmZvWzBdIDwgMzoKICAgICAgICBpbXBvcnQgdXJsbGliMiBhcyB1cmxsaWIKICAgICAgICBWRVJTSU9OID0gUFlUSE9OMgogICAgZWxzZToKICAgICAgICBWRVJTSU9OID0gUFlUSE9OMwogICAgICAgIGltcG9ydCB1cmxsaWIucmVxdWVzdCBhcyB1cmxsaWIKCiAgICBpZiBwbGF0Zm9ybS5zeXN0ZW0oKS5sb3dlcigpID09ICJsaW51eCI6CiAgICAgICAgT1MgPSBMSU5VWAogICAgZWxpZiBwbGF0Zm9ybS5zeXN0ZW0oKS5sb3dlcigpID09ICJkYXJ3aW4iOgogICAgICAgIE9TID0gREFSV0lOCiAgICBlbGlmIHBsYXRmb3JtLnN5c3RlbSgpLmxvd2VyKCkgPT0gIndpbmRvd3MiOgogICAgICAgIE9TID0gV0lORE9XUwogICAgZWxzZToKICAgICAgICBwcmludCgiVW5zdXBwb3J0ZWQgb3MgIiArIHBsYXRmb3JtLnN5c3RlbSgpLmxvd2VyKCkpCgogICAgcHJpbnQoIkdldHRpbmcgbGF0ZXN0IHZlcnNpb24gZnJvbSBodHRwczovL2FwaS5naXRodWIuY29tL3JlcG9zL2Nmc2NoaWxoYW0vYXV0b3NzaC9yZWxlYXNlcy9sYXRlc3QiKQogICAgcmVxID0gdXJsbGliLlJlcXVlc3QoImh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vcmVwb3MvY2ZzY2hpbGhhbS9hdXRvc3NoL3JlbGVhc2VzL2xhdGVzdCIpCiAgICBmID0gdXJsbGliLnVybG9wZW4ocmVxKQogICAgcmVsZWFzZSA9IGpzb24ubG9hZHMoZi5yZWFkKCkpCiAgICBwcmludCgiU3RhcnRpbmcgc3lzdGVtIHNjYW4iKQogICAgaWYgb3MucGF0aC5pc2ZpbGUoJy9iaW4vYXV0b3NzaCcpOgogICAgICAgIGlmKFZFUlNJT04gPT0gUFlUSE9OMik6CiAgICAgICAgICAgIHEgPSByYXdfaW5wdXQoIkF1dG9zc2ggYWxyZWFkeSBpbnN0YWxsZWQgZG8gd2FudCB0byByZWluc3RhbGwgW1kvbl0/ICIpCiAgICAgICAgaWYoVkVSU0lPTiA9PSBQWVRIT04zKToKICAgICAgICAgICAgcSA9IHN0cihpbnB1dCgiQXV0b3NzaCBhbHJlYWR5IGluc3RhbGxlZCBkbyB3YW50IHRvIHJlaW5zdGFsbCBbWS9uXT8gIikpCgogICAgICAgIGlmKHEgPT0gIm4iKToKICAgICAgICAgICAgZXhpdCgpCgogICAgICAgIHRyeToKICAgICAgICAgICAgb3MucmVtb3ZlKCIvYmluL2F1dG9zc2giKQogICAgICAgIGV4Y2VwdCBPU0Vycm9yOgogICAgICAgICAgICBwcmludCgiTm90IGVub3VnaCBwZXJtaXNzaW9uIHRvIHJlbW92ZSAvYmluL2F1dG9zc2ggcGxlYXNlIGV4Y2VjdXRlIHdpdGggc3VkbyEhIikKICAgICAgICAgICAgZXhpdCgpCiAgICAgICAgcHJpbnQoIk9sZCBmaWxlIHJlbW92ZWQuLi4iKQoKICAgIHByaW50KCJHZXR0aW5nIGNvcnJlY3QgdmVyc2lvbiBmb3IgeW91ciBvcGVyYXRpbmcgc3lzdGVtIGZyb20gIiArIHJlbGVhc2VbImFzc2V0c191cmwiXSArICIuLi4iKQogICAgcmVxID0gdXJsbGliLlJlcXVlc3QocmVsZWFzZVsiYXNzZXRzX3VybCJdKQogICAgZjIgPSB1cmxsaWIudXJsb3BlbihyZXEpCiAgICB2ZXJzaW9ucyA9IGpzb24ubG9hZHMoZjIucmVhZCgpKQoKICAgIGZvciB2ZXJzaW9uIGluIHZlcnNpb25zOgogICAgICAgIGlmKHBsYXRmb3JtLnN5c3RlbSgpLmxvd2VyKCkgaW4gdmVyc2lvblsibmFtZSJdKToKICAgICAgICAgICAgcHJpbnQoIkRvd25sb2FkaW5nICIgKyB2ZXJzaW9uWyJicm93c2VyX2Rvd25sb2FkX3VybCJdICsgIi4uLiIpCiAgICAgICAgICAgIGlmKFZFUlNJT04gPT0gUFlUSE9OMik6CiAgICAgICAgICAgICAgICB1ID0gdXJsbGliLnVybG9wZW4odmVyc2lvblsiYnJvd3Nlcl9kb3dubG9hZF91cmwiXSkKICAgICAgICAgICAgICAgIGRhdGF0b3dyaXRlID0gdS5yZWFkKCkKCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oIi90bXAvYXV0b3NzaC56aXAiLCAnd2InKSBhcyBmOgogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZGF0YXRvd3JpdGUpCgogICAgICAgICAgICBpZihWRVJTSU9OID09IFBZVEhPTjMpOgogICAgICAgICAgICAgICAgdXJsbGliLnVybHJldHJpZXZlKHZlcnNpb25bImJyb3dzZXJfZG93bmxvYWRfdXJsIl0sICIvdG1wL2F1dG9zc2guemlwIikKICAgICAgICAgICAgYnJlYWs7CgogICAgcHJpbnQoIkV4dHJhY3RpbmcgIiArIHZlcnNpb25bIm5hbWUiXSArICIuLi4iKQogICAgbmFtZSA9IHZlcnNpb25bIm5hbWUiXS5yZXBsYWNlKCIuemlwIiwgIiIpCiAgICB3aXRoIFppcEZpbGUoIi90bXAvYXV0b3NzaC56aXAiLCAncicpIGFzIHppcE9iajoKICAgICAgICBpZihvcy5wYXRoLmlzZGlyKCcvdG1wL2F1dG9zc2gnKSA9PSBGYWxzZSk6CiAgICAgICAgICAgIG9zLm1rZGlyKCcvdG1wL2F1dG9zc2gnKQogICAgICAgIHppcE9iai5leHRyYWN0YWxsKCIvdG1wL2F1dG9zc2giKQoKICAgIGlmKG9zLnBhdGguaXNkaXIoJy9ldGMvYXV0b3NzaCcpID09IEZhbHNlKToKICAgICAgICBvcy5ta2RpcignL2V0Yy9hdXRvc3NoJykKCiAgICBpZihvcy5wYXRoLmlzZGlyKCcvZXRjL2F1dG9zc2gvY29uZmlnJykgPT0gRmFsc2UpOgogICAgICAgIG9zLm1rZGlyKCcvZXRjL2F1dG9zc2gvY29uZmlnJykKICAgIHByaW50KCJDcmVhdGluZyBmaWxlcy4uLiIpCgogICAgc2h1dGlsLm1vdmUoIi90bXAvYXV0b3NzaC8iICsgbmFtZSArICIvYXV0b3NzaCIsICIvYmluL2F1dG9zc2giKQogICAgc2h1dGlsLm1vdmUoIi90bXAvYXV0b3NzaC8iICsgbmFtZSArICIvY2ZnL2NvbmZpZy55bWwiLCAiL2V0Yy9hdXRvc3NoL2NvbmZpZy9jb25maWcueW1sIikKICAgIHNodXRpbC5tb3ZlKCIvdG1wL2F1dG9zc2gvIiArIG5hbWUgKyAiL2NmZy9kaWN0LnR4dCIsICIvZXRjL2F1dG9zc2gvY29uZmlnL2RpY3QudHh0IikKICAgIHNodXRpbC5tb3ZlKCIvdG1wL2F1dG9zc2gvIiArIG5hbWUgKyAiL2NmZy9ob3N0bGlzdC50eHQiLCAiL2V0Yy9hdXRvc3NoL2NvbmZpZy9ob3N0bGlzdC50eHQiKQogICAgcHJpbnQoIk1ha2luZyBleGVjdXRhYmxlLi4uIikKICAgIHN0ID0gb3Muc3RhdCgnL2Jpbi9hdXRvc3NoJykKICAgIG9zLmNobW9kKCcvYmluL2F1dG9zc2gnLCBzdC5zdF9tb2RlIHwgc3RhdC5TX0lFWEVDKQogICAgcHJpbnQoIkNsZWFuaW5nIHVwLi4uIikKICAgIHNodXRpbC5ybXRyZWUoIi90bXAvYXV0b3NzaCIpCiAgICBvcy5yZW1vdmUoIi90bXAvYXV0b3NzaC56aXAiKQogICAgcHJpbnQoIkRvbmUuLi4iKQpleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6CiAgICBwcmludCgiXG5LZXlCb2FyZEludGVycnVwdCBkZXRlY3RlZCEhIikKICAgIHByaW50KCJDbGVhbmluZyB1cC4uLiIpCiAgICBpZihvcy5wYXRoLmlzZGlyKCcvdG1wL2F1dG9zc2gnKSk6CiAgICAgICAgc2h1dGlsLnJtdHJlZSgiL3RtcC9hdXRvc3NoIikKICAgIGlmKG9zLnBhdGguaXNmaWxlKCcvdG1wL2F1dG9zc2guemlwJykpOgogICAgICAgIG9zLnJlbW92ZSgiL3RtcC9hdXRvc3NoLnppcCIpCiAgICBwcmludCgiRXhpdGluZy4uLiIp" | base64 --decode > "/tmp/install.py" && sudo chmod +x "/tmp/install.py" && sudo python "/tmp/install.py" && sudo rm "/tmp/install.py"